function afixCard(e,a){e.addClass("locked").css({top:splaySize*a})}function unfixCard(e,a){e.removeClass("locked").css({top:cardHeight*a})}function lockCards(){var e;for(e=1;e<$allcards.length;e++)$(window).scrollTop()>=cardHeight*e-splaySize*e?afixCard($allcards.eq(e),e):unfixCard($allcards.eq(e),e)}function scrollToCard(e){var a=e.parents(".card"),s;s=a.hasClass("top-card")?0:a.hasClass("locked")?parseInt(a.css("top"))/splaySize:parseInt(a.css("top"))/cardHeight,$("html, body").animate({scrollTop:s*cardHeight},850)}function hintArrowScroll(e){var a=e.parents(".card");scrollToCard(a.next(".card").find("a.section-anchor"))}function scrollAnimations(e){$(window).scrollTop()>450&&$(".portfolio-link").addClass("in-view"),$(window).scrollTop()>335?e.addClass("repositioned"):e.removeClass("repositioned")}var app=angular.module("trekApp",[]);app.controller("trekController",function(e){e.shipList=angular.fromJson(fleet),e.selectedShip=e.shipList[0]});var dominion=angular.module("dominion",[]);dominion.controller("dominionController",function(e){function a(e){return e.status===!0}e.setDefaults=function(a,s,t,o,r,n){e.colPlat=a,e.shelters=s,e.events=t,e.landmarks=o,e.react=r,e.spread=n},e.setDefaults("pros","da","two","one",!0,!0),e.allCards=angular.fromJson(cardsJSON),e.expansions=[{name:"Dominion",status:!0},{name:"Intrigue",status:!1},{name:"Seaside",status:!1},{name:"Alchemy",status:!1},{name:"Prosperity",status:!1},{name:"Cornucopia",status:!1},{name:"Hinterlands",status:!1},{name:"Dark Ages",status:!1},{name:"Guilds",status:!1},{name:"Adventures",status:!1},{name:"Empires",status:!0}],e.generate=function(){function s(){e.setup.push("Shelters")}if(e.setup=[],e.activeExpansions=e.expansions.filter(a),e.activeExpansions.length>0){e.filteredCards=[];var t,o;for(t=0;t<e.allCards.length;t++)for(o=0;o<e.activeExpansions.length;o++)e.allCards[t].exp===e.activeExpansions[o].name&&(e.allCards[t].costSelected=!1,e.filteredCards.push(e.allCards[t]));e.kingdom=[];var r,n,l,i=!1,d=0,c=!1,p=0,h=0,u=0,f,m;for(e.spread===!0&&(f=2),r=0;10>r;r++){if(e.spread===!0&&f>=2&&5>=f)for(m=!1;m===!1;)l=Math.floor(Math.random()*e.filteredCards.length),n=e.filteredCards[l],n.cost_treasure!==f&&n.cost_debt!==f||(n.costSelected=!0,m=!0,f++);else l=Math.floor(Math.random()*e.filteredCards.length),n=e.filteredCards[l],n.costSelected=!1;e.kingdom.push(n),e.filteredCards.splice(l,1),i===!1&&"Young Witch"===n.name&&(i=!0),c===!1&&"Hermit"===n.name&&(c=!0),"pros"===e.colPlat&&"Prosperity"===n.exp&&h++,"da"===e.shelters&&"Dark Ages"===n.exp&&u++,n.is_attack&&d++,n.is_reaction&&p++}if(e.react&&1>p&&d>0){var g=e.filteredCards.slice(),C=!1,k;if(1===d)for(;e.kingdom.length>9;)l=Math.floor(Math.random()*e.kingdom.length),e.kingdom[l].is_attack===!1&&e.kingdom[l].costSelected===!1&&e.kingdom.splice(l,1);else for(var v=!1;v===!1;)l=Math.floor(Math.random()*e.kingdom.length),e.kingdom[l].costSelected===!1&&(e.kingdom.splice(l,1),v=!0);for(;C===!1&&g.length>0;)l=Math.floor(Math.random()*g.length),k=g[l],k.is_reaction?(C=!0,e.kingdom.push(k),e.filteredCards.splice(l,1)):g.splice(l,1);C===!1&&alert("No reaction card could be found in the sets specified.")}for(r=0;r<e.kingdom.length;r++)e.kingdom[r].is_bane=!1;for(var x,M=e.filteredCards.slice();i===!0&&M.length>0;)l=Math.floor(Math.random()*M.length),x=e.filteredCards[l],M.splice(l,1),3!==x.cost_treasure&&2!==x.cost_treasure||0!==x.cost_potions||(x.is_bane=!0,e.kingdom.push(x),e.filteredCards.splice(l,1),i=!1);if(i&&alert("A Bane card could not be found in the remaining selected cards. The card Young Witch from Cornucopia requires an 11th card be added to the Kingdom of cost 2 or 3. No cards are available that meet that critera."),"on"===e.colPlat)e.setup.push("Colonies and Platinums");else if("pros"===e.colPlat){var S=e.kingdom.slice();h>=7?e.setup.push("Colonies and Platinums"):h>2&&7>h&&(l=Math.ceil(Math.random()*S.length),h>=l&&e.setup.push("Colonies and Platinums"))}else"first"===e.colPlat?"Prosperity"===e.kingdom[0].exp&&e.setup.push("Colonies and Platinums"):"rand"===e.colPlat&&100*Math.random()>59&&e.setup.push("Colonies and Platinums");if("on"===e.shelters)s();else if("first"===e.shelters)"Dark Ages"==e.kingdom[0].exp&&s();else if("rand"===e.shelters)100*Math.random()>59&&s();else if("da"===e.shelters){var S=e.kingdom.slice();u>=7?s():u>2&&7>h&&(l=Math.ceil(Math.random()*S.length),u>l&&s())}var w,P=0;for(w=0;w<e.kingdom.length;w++)e.kingdom[w].costSelected&&P++;console.log("Cost Selected Cards:"+P)}else alert("At least one Expansion must be selected to randomize.")}});var cardHeight=800,splaySize=60,$allcards=$(".big-wrap .container-fluid .card"),prevZ,i;for(i=1;i<$allcards.length;i++)prevZ=parseInt($allcards.eq(i-1).css("z-index")),$allcards.eq(i).css({top:i*cardHeight,"z-index":prevZ+100});$(document).ready(function(){lockCards(),$(window).scroll(function(){lockCards(),scrollAnimations($(".top-card h1"))}),$("a.section-anchor").click(function(e){scrollToCard($(this)),e.preventDefault()}),$(".hint-arrow>a").click(function(e){hintArrowScroll($(this)),e.preventDefault()}),$('[data-toggle="tooltip"]').tooltip().css("cursor","pointer")});